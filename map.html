<!DOCTYPE html>
<html>
<head>
  <title>RouteRush Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css">
  <style>
    #map { height: 500px; margin: 20px; border-radius: 10px; }
    .bounce {
      animation: bounce 0.8s infinite alternate;
    }
    @keyframes bounce {
      0% { transform: translateY(0px); }
      100% { transform: translateY(-10px); }
    }
    button {
      background:#007B8F; color:#fff; border:none; padding:8px 12px;
      margin:5px; border-radius:5px; cursor:pointer;
    }
    button:hover { background:#005f70; }
    .map-loader {
      position:fixed;
      top:0; left:0;
      width:100%; height:100%;
      background: rgba(255,255,255,0.8);
      display:flex;
      justify-content:center;
      align-items:center;
      z-index:9999;
    }
    .spinner {
      border: 6px solid #f3f3f3;
      border-top: 6px solid #007B8F;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
<h2 style="text-align:center;">🗺️ RouteRush Map</h2>

<div style="text-align:center; padding:10px;">
  <input id="fromPlace" placeholder="From" style="padding:8px;">
  <input id="toPlace" placeholder="To" style="padding:8px;">
  <select id="mode" style="padding:8px;">
    <option value="car">🚗 Car</option>
    <option value="bike">🚴‍♂️ Bike</option>
    <option value="foot">🚶 Walk</option>
  </select>
  <button onclick="findRoute()">Show Route</button>
  <button onclick="clearRoute()">Clear Route</button>
</div>

<div id="map"></div>
<div id="routeInfo" style="text-align:center; font-weight:bold; padding:10px;"></div>

<div style="text-align:center;">
  <button onclick="copyLink()">📋 Copy Map Link</button>
</div>

<div class="map-loader" id="mapLoader" style="display:none;">
  <div class="spinner"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.min.js"></script>

<script>
const map = L.map('map').setView([15,75],7);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

let control, fromMarker, toMarker;

function findRoute() {
  const from = document.getElementById('fromPlace').value;
  const to = document.getElementById('toPlace').value;
  const mode = document.getElementById('mode').value;
  document.getElementById('routeInfo').innerHTML = "";
  if (!from || !to) { alert("Enter both places"); return; }

  document.getElementById('mapLoader').style.display = 'flex';

  Promise.all([
    fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(from)}`).then(r=>r.json()),
    fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(to)}`).then(r=>r.json())
  ]).then(([fromData, toData])=>{
    if (!fromData[0] || !toData[0]) { alert("Places not found."); document.getElementById('mapLoader').style.display='none'; return; }

    const fromLatLng = L.latLng(fromData[0].lat, fromData[0].lon);
    const toLatLng = L.latLng(toData[0].lat, toData[0].lon);

    if (control) map.removeControl(control);
    if (fromMarker) map.removeLayer(fromMarker);
    if (toMarker) map.removeLayer(toMarker);

    const iconBounce = L.icon({
      iconUrl: 'https://cdn-icons-png.flaticon.com/512/684/684908.png',
      iconSize: [36,36],
      className: 'bounce'
    });

    fromMarker = L.marker(fromLatLng, {icon: iconBounce}).addTo(map).bindPopup("Start: " + from);
    toMarker = L.marker(toLatLng, {icon: iconBounce}).addTo(map).bindPopup("End: " + to);

    control = L.Routing.control({
      waypoints: [fromLatLng, toLatLng],
      router: L.Routing.osrmv1({serviceUrl: `https://router.project-osrm.org/route/v1/${mode}`}),
      routeWhileDragging: false, show: false
    }).addTo(map);

    control.on('routesfound', function(e) {
      const route = e.routes[0];
      const km = (route.summary.totalDistance/1000).toFixed(2);
      const s = route.summary.totalTime;
      const d = Math.floor(s/86400), h = Math.floor((s%86400)/3600), m = Math.floor((s%3600)/60);
      let dur = '';
      if(d>0) dur+=d+'d ';
      if(h>0) dur+=h+'h ';
      if(m>0) dur+=m+'m';
      document.getElementById('routeInfo').innerText = `🚩 ${km} km | ⏳ ${dur}`;
      document.getElementById('mapLoader').style.display='none';
    });
  }).catch(()=>{ alert("Something went wrong."); document.getElementById('mapLoader').style.display='none'; });
}

function clearRoute() {
  if (control) { map.removeControl(control); control = null; }
  if (fromMarker) { map.removeLayer(fromMarker); fromMarker = null; }
  if (toMarker) { map.removeLayer(toMarker); toMarker = null; }
  document.getElementById('routeInfo').innerHTML = "";
  document.getElementById('fromPlace').value = "";
  document.getElementById('toPlace').value = "";
}

function copyLink() {
  navigator.clipboard.writeText(window.location.href)
  .then(()=>alert("Map link copied to clipboard!"))
  .catch(()=>alert("Failed to copy link."));
}
</script>
</body>
</html>
